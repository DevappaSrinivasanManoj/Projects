<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple EPUB Reader</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #file-input {
            margin-bottom: 20px;
        }
        #content {
            padding: 20px;
            line-height: 1.6;
            border: 1px solid #ddd;
            border-radius: 5px;
            min-height: 200px;
            max-height: 70vh;
            overflow-y: auto;
        }
        #title {
            margin-bottom: 20px;
            color: #333;
        }
        .chapter-title {
            color: #2c3e50;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="title">Simple EPUB Reader</h1>
        <input type="file" id="file-input" accept=".epub">
        <div id="content"></div>
    </div>

    <script>
        document.getElementById('file-input').addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            try {
                const zip = new JSZip();
                const contents = await zip.loadAsync(file);
                
                // Find the container.xml file
                const containerData = await contents.file('META-INF/container.xml').async('text');
                const parser = new DOMParser();
                const containerXml = parser.parseFromString(containerData, 'text/xml');
                const rootFilePath = containerXml.querySelector('rootfile').getAttribute('full-path');

                // Read the content.opf file
                const contentOpfData = await contents.file(rootFilePath).async('text');
                const contentOpf = parser.parseFromString(contentOpfData, 'text/xml');

                // Get spine items
                const spine = Array.from(contentOpf.querySelectorAll('spine itemref')).map(item => 
                    item.getAttribute('idref')
                );

                // Get manifest items
                const manifest = {};
                contentOpf.querySelectorAll('manifest item').forEach(item => {
                    manifest[item.getAttribute('id')] = item.getAttribute('href');
                });

                // Get the base directory of the OPF file
                const baseDir = rootFilePath.split('/').slice(0, -1).join('/');
                if (baseDir) baseDir + '/';

                // Display content
                const contentDiv = document.getElementById('content');
                contentDiv.innerHTML = ''; // Clear previous content

                // Read and display each spine item
                for (const itemId of spine) {
                    const href = manifest[itemId];
                    if (!href) continue;

                    const fullPath = baseDir + href;
                    const chapterContent = await contents.file(fullPath).async('text');
                    const chapterDoc = parser.parseFromString(chapterContent, 'text/html');
                    
                    // Extract and append text content
                    const chapterDiv = document.createElement('div');
                    chapterDiv.className = 'chapter';
                    chapterDiv.innerHTML = chapterDoc.body.innerHTML;
                    
                    // Basic sanitization (remove scripts and style tags)
                    chapterDiv.querySelectorAll('script, style').forEach(el => el.remove());
                    
                    contentDiv.appendChild(chapterDiv);
                }
            } catch (error) {
                console.error('Error reading EPUB:', error);
                document.getElementById('content').innerHTML = 'Error reading EPUB file. Please make sure it\'s a valid EPUB format.';
            }
        });
    </script>
</body>
</html> 